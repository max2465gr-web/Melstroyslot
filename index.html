<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino Deluxe</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap');

        :root {
            --bg-dark: #051e3e;
            --bg-light: #1e5799;
            --neon-blue: #00f2ff;
            --gold-light: #fceabb;
            --gold-dark: #f8b500;
            --gold-shadow: #b06602;
            --red-ball: #d92e2e;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at center, var(--bg-light) 0%, var(--bg-dark) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            user-select: none;
        }

        /* === –§–û–ù–û–í–´–ï –≠–õ–ï–ú–ï–ù–¢–´ (–ó–í–ï–ó–î–´) === */
        .star {
            position: absolute;
            color: #ffd700;
            font-size: 20px;
            animation: twinkle 3s infinite ease-in-out;
            opacity: 0.8;
            z-index: 0;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* === –í–´–í–ï–°–ö–ê === */
        .neon-sign {
            font-size: 50px;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 5px;
            margin-bottom: 30px;
            text-shadow:
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 20px var(--neon-blue),
                0 0 40px var(--neon-blue),
                0 0 80px var(--neon-blue);
            z-index: 2;
            position: relative;
        }

        /* === –ö–û–ù–¢–ï–ô–ù–ï–† –ê–ü–ü–ê–†–ê–¢–ê === */
        .machine-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: scale(1);
            transition: transform 0.3s;
            z-index: 2;
        }

        /* –ö–û–†–ü–£–° –°–õ–û–¢–ê */
        .slot-machine {
            width: 320px;
            height: 260px;
            background: linear-gradient(135deg, var(--gold-dark) 0%, var(--gold-light) 50%, var(--gold-dark) 100%);
            border-radius: 30px;
            padding: 20px;
            box-shadow:
                inset 0 0 20px rgba(255, 255, 255, 0.5), /* –ë–ª–∏–∫ –≤–Ω—É—Ç—Ä–∏ */
                0 20px 50px rgba(0,0,0,0.6), /* –¢–µ–Ω—å —Å–Ω–∞—Ä—É–∂–∏ */
                0 0 0 5px var(--gold-shadow); /* –ö–æ–Ω—Ç—É—Ä */
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* –≠–ö–†–ê–ù –° –ë–ê–†–ê–ë–ê–ù–ê–ú–ò */
        .screen-border {
            width: 100%;
            height: 180px;
            background: #2a1f08;
            border-radius: 15px;
            padding: 10px;
            box-shadow: inset 0 0 15px #000;
            display: flex;
            justify-content: center;
        }

        .reels-container {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 10px;
            display: flex;
            overflow: hidden;
            border: 2px solid #000;
            position: relative;
        }

        /* –ë–ª–∏–∫–∏ –Ω–∞ —Å—Ç–µ–∫–ª–µ */
        .glass-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 50%);
            z-index: 10;
            pointer-events: none;
        }

        /* –õ–ò–ù–ò–Ø –ü–û–ë–ï–î–´ */
        .payline {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 0, 0, 0.5);
            transform: translateY(-50%);
            z-index: 5;
            box-shadow: 0 0 10px red;
            display: none; /* –°–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }

        .reel {
            flex: 1;
            border-right: 2px solid #ccc;
            position: relative;
        }
        .reel:last-child { border-right: none; }

        .reel-strip {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            /* transform —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS */
        }

        .symbol {
            height: 80px; /* –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–π —è—á–µ–π–∫–∏ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
        }

        .blur { filter: blur(3px); }

        /* –ò–ù–§–û –ü–ê–ù–ï–õ–¨ (–ë–ê–õ–ê–ù–°) */
        .info-panel {
            margin-top: 15px;
            background: #000;
            border: 2px solid var(--gold-light);
            border-radius: 20px;
            padding: 5px 20px;
            color: var(--gold-light);
            font-size: 18px;
            text-align: center;
            width: 80%;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* === –†–´–ß–ê–ì (LEVER) === */
        .lever-container {
            position: absolute;
            right: -50px; /* –°–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ –æ—Ç –∫–æ—Ä–ø—É—Å–∞ */
            top: 50px;    /* –í—ã—Å–æ—Ç–∞ –∫—Ä–µ–ø–ª–µ–Ω–∏—è */
            width: 60px;
            height: 200px;
            z-index: 1;
        }

        /* –ë–∞–∑–∞ –∫—Ä–µ–ø–ª–µ–Ω–∏—è –∫ –∫–æ—Ä–ø—É—Å—É */
        .lever-mount {
            position: absolute;
            left: -10px;
            top: 80px;
            width: 30px;
            height: 60px;
            background: linear-gradient(to right, #888, #ccc);
            border-radius: 5px;
            z-index: 2;
            box-shadow: -5px 0 10px rgba(0,0,0,0.5);
        }

        /* –ü–æ–¥–≤–∏–∂–Ω–∞—è —Ä—É–∫–æ—è—Ç–∫–∞ */
        .lever-handle {
            position: absolute;
            left: 10px;
            top: 110px; /* –¢–æ—á–∫–∞ –≤—Ä–∞—â–µ–Ω–∏—è (pivot point) */
            width: 20px;
            height: 120px; /* –î–ª–∏–Ω–∞ –ø–∞–ª–∫–∏ –≤–≤–µ—Ä—Ö */
            transform-origin: bottom center; /* –í—Ä–∞—â–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∑–∞ */
            transform: rotate(0deg); /* 0deg - —Å—Ç–æ–∏—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –≤–≤–µ—Ä—Ö? –ù–µ—Ç, –ø–æ–ø—Ä–∞–≤–∏–º –ª–æ–≥–∏–∫—É */
            /* –ú—ã —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫: –ø–∞–ª–∫–∞ —Å–º–æ—Ç—Ä–∏—Ç –≤–≤–µ—Ä—Ö. –í—Ä–∞—â–∞–µ–º –í–ü–ï–†–ï–î (–Ω–∞ —Å–µ–±—è/–≤–Ω–∏–∑) */
        }

        /* –°—Ç–µ—Ä–∂–µ–Ω—å */
        .lever-stick {
            width: 15px;
            height: 100%;
            background: linear-gradient(90deg, #e6b853, #fff, #b58928);
            border-radius: 10px;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
        }

        /* –®–∞—Ä */
        .lever-knob {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #ff5e5e, var(--red-ball));
            border-radius: 50%;
            position: absolute;
            top: -30px; /* –ù–∞ –≤–µ—Ä—Ö—É—à–∫–µ –ø–∞–ª–∫–∏ */
            left: 50%;
            transform: translateX(-50%);
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.3), 5px 10px 15px rgba(0,0,0,0.4);
            cursor: grab;
            z-index: 10;
        }
        .lever-knob:active { cursor: grabbing; }

        /* –°–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ */
        #status {
            position: fixed;
            bottom: 20px;
            font-size: 20px;
            color: #fff;
            text-shadow: 0 2px 4px #000;
            z-index: 10;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 450px) {
            .machine-wrapper { transform: scale(0.85); }
            .neon-sign { font-size: 40px; }
        }

    </style>
</head>
<body>

    <!-- –§–æ–Ω: –ó–≤–µ–∑–¥—ã -->
    <div class="star" style="top: 10%; left: 10%;">‚òÖ</div>
    <div class="star" style="top: 20%; right: 15%; animation-delay: 1s;">‚òÖ</div>
    <div class="star" style="top: 80%; left: 20%; animation-delay: 0.5s;">‚òÖ</div>
    <div class="star" style="top: 70%; right: 10%; animation-delay: 1.5s;">‚òÖ</div>
    <div class="star" style="top: 15%; left: 50%; font-size: 10px;">‚òÖ</div>

    <div class="neon-sign">CASINO</div>

    <div class="machine-wrapper">
        <!-- –ê–ø–ø–∞—Ä–∞—Ç -->
        <div class="slot-machine">
            <div class="screen-border">
                <div class="reels-container">
                    <div class="payline"></div>
                    <div class="glass-overlay"></div>
                    <div class="reel"><div class="reel-strip" id="reel1"></div></div>
                    <div class="reel"><div class="reel-strip" id="reel2"></div></div>
                    <div class="reel"><div class="reel-strip" id="reel3"></div></div>
                </div>
            </div>

            <div class="info-panel">
                <span id="balance">BALANCE: 1000</span>
            </div>
        </div>

        <!-- –†—ã—á–∞–≥ -->
        <div class="lever-container">
            <div class="lever-mount"></div>
            <!-- –í—Ä–∞—â–∞—é—â–∞—è—Å—è —á–∞—Å—Ç—å -->
            <div class="lever-handle" id="leverHandle">
                <div class="lever-stick"></div>
                <div class="lever-knob" id="leverKnob"></div>
            </div>
        </div>
    </div>

    <div id="status">WIN! +500</div>

    <script>
        // === –ù–ê–°–¢–†–û–ô–ö–ò ===
        const SYMBOLS = ['üíé', '7Ô∏è‚É£', 'üîî', 'üçí', 'üçã', 'üçâ', '‚≠ê', 'üí∞', 'üçä'];
        const SYMBOL_HEIGHT = 80; // px, –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å CSS
        const PAYOUTS = {
            'üíé': 1000, '7Ô∏è‚É£': 500, 'üí∞': 300, '‚≠ê': 200,
            'üîî': 100, 'üçâ': 50, 'üçí': 20
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const reels = [
            document.getElementById('reel1'),
            document.getElementById('reel2'),
            document.getElementById('reel3')
        ];
        const balanceEl = document.getElementById('balance');
        const statusEl = document.getElementById('status');
        const payline = document.querySelector('.payline');

        // –†—ã—á–∞–≥
        const leverHandle = document.getElementById('leverHandle');
        const leverKnob = document.getElementById('leverKnob');

        let balance = 1000;
        let isSpinning = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞—Ä–∞–±–∞–Ω—ã –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
            reels.forEach(reel => {
                reel.innerHTML = generateStripHTML(20);
                // –°—Ç–∞–≤–∏–º –≤ –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é (–ø—Ä–∏–º–µ—Ä–Ω–æ —Å–µ—Ä–µ–¥–∏–Ω–∞)
                setReelPosition(reel, 10);
            });

            // –ë–∞–ª–∞–Ω—Å –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const startBal = parseInt(urlParams.get('balance'));
            if(!isNaN(startBal)) balance = startBal;
            updateBalance();
        }

        function generateStripHTML(count) {
            let html = '';
            for(let i=0; i<count; i++) {
                const sym = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                html += `<div class="symbol">${sym}</div>`;
            }
            return html;
        }

        function setReelPosition(reel, index) {
            // –°–º–µ—â–∞–µ–º `strip` —Ç–∞–∫, —á—Ç–æ–±—ã —Å–∏–º–≤–æ–ª `index` –±—ã–ª –ø–æ —Ü–µ–Ω—Ç—Ä—É
            // –¶–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ (–≤—ã—Å–æ—Ç–∞ 180px) = 90px.
            // –¶–µ–Ω—Ç—Ä —Å–∏–º–≤–æ–ª–∞ (–≤—ã—Å–æ—Ç–∞ 80px) = 40px.
            // –ü–æ–∑–∏—Ü–∏—è –≤–µ—Ä—Ö–∞ —Å–∏–º–≤–æ–ª–∞ = index * 80.
            // transform Y = -(index * 80) + (90 - 40)
            const y = -(index * SYMBOL_HEIGHT) + 50;
            reel.style.transform = `translateY(${y}px)`;
        }

        function updateBalance() {
            balanceEl.textContent = `BALANCE: ${balance}`;
        }

        function showStatus(text, color='#fff') {
            statusEl.textContent = text;
            statusEl.style.color = color;
            statusEl.style.opacity = '1';
            setTimeout(() => {
                statusEl.style.opacity = '0';
            }, 2000);
        }

        // === –ú–ï–•–ê–ù–ò–ö–ê –†–´–ß–ê–ì–ê (DRAG DOWN) ===
        let isDragging = false;
        let startY = 0;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
        function resetLever() {
            leverHandle.style.transition = 'transform 0.5s cubic-bezier(0.5, 1.5, 0.5, 1)'; // –ü—Ä—É–∂–∏–Ω–∏—Å—Ç—ã–π –≤–æ–∑–≤—Ä–∞—Ç
            leverHandle.style.transform = 'rotate(0deg)';
            setTimeout(() => {
                leverHandle.style.transition = ''; // –£–±–∏—Ä–∞–µ–º transition –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            }, 500);
        }

        function onStart(e) {
            if(isSpinning) return;
            isDragging = true;
            startY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            leverKnob.style.cursor = 'grabbing';
        }

        function onMove(e) {
            if(!isDragging) return;
            e.preventDefault(); // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª

            const currentY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            const deltaY = currentY - startY;

            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤–Ω–∏–∑ (px) –≤ —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ (deg)
            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª - 130 –≥—Ä–∞–¥—É—Å–æ–≤ (—Ä—ã—á–∞–≥ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω–∏–∑)
            let angle = deltaY * 0.5;

            if (angle < 0) angle = 0; // –ù–µ–ª—å–∑—è —Ç–æ–ª–∫–∞—Ç—å –≤–≤–µ—Ä—Ö
            if (angle > 130) angle = 130; // –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å

            leverHandle.style.transform = `rotate(${angle}deg)`;
        }

        function onEnd(e) {
            if(!isDragging) return;
            isDragging = false;
            leverKnob.style.cursor = 'grab';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —É–≥–æ–ª
            // –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —É–≥–æ–ª, –ø–∞—Ä—Å–∏–º transform –∏–ª–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º
            // –ü—Ä–æ—â–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ onMove, –Ω–æ –º–æ–∂–Ω–æ –∏ —Ç–∞–∫:
            const style = window.getComputedStyle(leverHandle);
            const matrix = new DOMMatrix(style.transform);
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —É–≥–æ–ª –ø—Ä–∏–º–µ—Ä–Ω–æ (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–æ–∑—å–º–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π angle –∏–∑ –ª–æ–≥–∏–∫–∏, –µ—Å–ª–∏ –±—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏,
            // –Ω–æ —Ç–∞–∫ –∫–∞–∫ –º—ã –æ—Ç–ø—É—Å—Ç–∏–ª–∏, –ø—Ä–æ–≤–µ—Ä–∏–º, "–≥–ª—É–±–æ–∫–æ" –ª–∏ —É—Ç—è–Ω—É–ª–∏)

            // –ü–æ–ª—É—á–∏–º —É–≥–æ–ª –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å—Ç–∏–ª—è (—ç—Ç–æ –∫–æ—Å—Ç—ã–ª—å, –Ω–æ —Ä–∞–±–æ—á–∏–π)
            // –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ç—è–Ω—É–ª —Ä—ã—á–∞–≥ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∏–∑–∫–æ (–≤–∏–∑—É–∞–ª—å–Ω–æ)
            // –ú—ã –∑–Ω–∞–µ–º, —á—Ç–æ 130deg - —ç—Ç–æ –º–∞–∫—Å. –ï—Å–ª–∏ —É—Ç—è–Ω—É–ª–∏ > 100deg - –ø—É—Å–∫.

            // –ü—Ä–æ—â–µ: –º—ã –∑–Ω–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è. –ù–æ –ª—É—á—à–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å transform.
            // –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –ø—Ä–æ—â–µ: –µ—Å–ª–∏ mouseUP –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–∏–ª—å–Ω–æ –Ω–∏–∂–µ startY
            const endY = e.type.includes('touch') ? e.changedTouches[0].clientY : e.clientY;
            const dist = endY - startY;

            if (dist > 150) { // –ï—Å–ª–∏ –ø—Ä–æ—Ç—è–Ω—É–ª–∏ –≤–Ω–∏–∑ –±–æ–ª–µ–µ 150px
                startSpin();
            }

            resetLever();
        }

        leverKnob.addEventListener('mousedown', onStart);
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onEnd);

        leverKnob.addEventListener('touchstart', onStart, {passive: false});
        document.addEventListener('touchmove', onMove, {passive: false});
        document.addEventListener('touchend', onEnd);


        // === –õ–û–ì–ò–ö–ê –ò–ì–†–´ ===
        function startSpin() {
            if(balance < 50) {
                showStatus("NO MONEY!", "red");
                return;
            }

            isSpinning = true;
            balance -= 50;
            updateBalance();
            payline.style.display = 'none';

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const finalSymbols = [];
            for(let i=0; i<3; i++) {
                finalSymbols.push(SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)]);
            }

            // –ó–∞–ø—É—Å–∫–∞–µ–º –±–∞—Ä–∞–±–∞–Ω—ã
            reels.forEach((reel, i) => {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
                const extraCount = 20 + i * 5; // –†–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏
                const newHtml = generateStripHTML(extraCount);

                // –ß—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è –±—ã–ª–∞ –ø–ª–∞–≤–Ω–æ–π, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∏–º–≤–æ–ª—ã "—Å–≤–µ—Ä—Ö—É",
                // –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –≤–∏–¥–∏–º–æ—Å—Ç–∏, –∞ –ø–æ—Ç–æ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–∑.
                // –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±:
                // 1. –¢–µ–∫—É—â–∏–π HTML –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –ù–æ–≤—ã–π + –°—Ç–∞—Ä—ã–π
                // 2. –°–º–µ—â–∞–µ–º translateY —Ç–∞–∫, —á—Ç–æ–±—ã –≤–∏–∑—É–∞–ª—å–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                // 3. –ê–Ω–∏–º–∏—Ä—É–µ–º transition –≤ 0 (–∏–ª–∏ –∫ –Ω–æ–≤–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É)

                // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç CSS-only:
                // –ü—Ä–æ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –¥–ª–∏–Ω–Ω—É—é –ª–µ–Ω—Ç—É, –≥–¥–µ –≤ –∫–æ–Ω—Ü–µ - –Ω–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
                // –ò —Å—Ç–∞–≤–∏–º –µ—ë —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∞ "–ø—Ä–æ–µ–∑–∂–∞–ª–∞"

                const winSymbolIndex = extraCount - 2; // –ü—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª - –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π

                // –í—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à–Ω—ã–π —Å–∏–º–≤–æ–ª –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
                let stripArr = [];
                for(let k=0; k<extraCount; k++) {
                    stripArr.push(SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)]);
                }
                stripArr[winSymbolIndex] = finalSymbols[i];

                // –°–æ–±–∏—Ä–∞–µ–º HTML
                reel.innerHTML = stripArr.map(s => `<div class="symbol ${Math.random()>0.5?'blur':''}">${s}</div>`).join('');

                // –°–Ω–∏–º–∞–µ–º –±–ª—é—Ä —Å —Ü–µ–ª–µ–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
                const targetDiv = reel.children[winSymbolIndex];
                targetDiv.classList.remove('blur');
                targetDiv.id = `res-${i}`;

                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–ª–µ–Ω—Ç–∞ –∑–∞–¥—Ä–∞–Ω–∞ –≤–≤–µ—Ä—Ö)
                reel.style.transition = 'none';
                reel.style.transform = `translateY(0px)`; // –ù–∞—á–∞–ª–æ –ª–µ–Ω—Ç—ã

                // –ó–∞—Å—Ç–∞–≤–ª—è–µ–º –±—Ä–∞—É–∑–µ—Ä –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª–∏
                reel.offsetHeight;

                // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–ª–µ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
                // –ú—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã `winSymbolIndex` –æ–∫–∞–∑–∞–ª—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É.
                // Y = -(winSymbolIndex * 80) + 50
                const targetY = -(winSymbolIndex * SYMBOL_HEIGHT) + 50;

                // –ê–Ω–∏–º–∞—Ü–∏—è
                const time = 2 + i * 0.5;
                reel.style.transition = `transform ${time}s cubic-bezier(0.15, 0.1, 0.25, 1)`;
                reel.style.transform = `translateY(${targetY}px)`;
            });

            setTimeout(() => {
                checkWin(finalSymbols);
                isSpinning = false;
            }, 3500);
        }

        function checkWin(results) {
            const [s1, s2, s3] = results;

            // –£–±–∏—Ä–∞–µ–º –±–ª—é—Ä —Å–æ –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            document.querySelectorAll('.symbol').forEach(el => el.classList.remove('blur'));

            let win = 0;
            if(s1 === s2 && s2 === s3) {
                win = PAYOUTS[s1] || 100;
                showStatus(`JACKPOT! +${win}`, '#00ff00');
                payline.style.display = 'block';
            } else if (s1 === s2 || s2 === s3 || s1 === s3) {
                 win = 20;
                 showStatus(`SMALL WIN +${win}`, '#ffd700');
            } else {
                showStatus("TRY AGAIN", "#ccc");
            }

            if(win > 0) {
                balance += win;
                updateBalance();
            }
        }

        init();
    </script>
</body>
</html>
